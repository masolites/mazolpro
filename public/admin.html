<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MAZOL-Pro Admin</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>MAZOL-Pro Admin Dashboard</h1>
  </header>
  <main>
    <section>
      <h3>Approve Manual Deposits</h3>
      <button onclick="approveDeposit()">Approve</button>
      <div id="approve-result" class="result"></div>
    </section>
    <section>
      <h3>Set Withdrawal Fee</h3>
      <input type="number" id="withdrawal-fee" step="0.01" placeholder="Fee (e.g. 0.05 for 5%)"/>
      <button onclick="setWithdrawalFee()">Set Fee</button>
      <div id="fee-result" class="result"></div>
    </section>
    <!-- Add more admin controls as needed -->
  </main>
  <footer>
    <a href="index.html">Back to User Site</a>
  </footer>
  <script src="script.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MAZOL-Pro Admin Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>MAZOL-Pro Admin</h1>
    <h2>Platform Management</h2>
  </header>
  <main>
    <!-- Admin Login -->
    <section id="admin-login-section">
      <h3>Admin Login</h3>
      <form id="admin-login-form" class="form-group">
        <label>
          Username
          <input type="text" id="admin-username" required />
        </label>
        <label>
          Password
          <input type="password" id="admin-password" required />
        </label>
        <button type="submit">Login</button>
      </form>
      <div id="admin-login-result" class="result"></div>
    </section>

    <!-- Admin Panel (hidden until login) -->
    <section id="admin-panel" style="display:none;">
      <h3>User Management</h3>
      <form id="user-search-form" class="form-group">
        <label>
          User Wallet/Email
          <input type="text" id="user-search" required />
        </label>
        <button type="submit">Search User</button>
      </form>
      <div id="user-settings" class="result"></div>

      <h3>Manual Deposit Approvals</h3>
      <button onclick="fetchDeposits()">Refresh Pending Deposits</button>
      <div id="pending-deposits" class="result"></div>

      <h3>Withdrawal Management</h3>
      <button onclick="fetchWithdrawals()">Refresh Pending Withdrawals</button>
      <div id="pending-withdrawals" class="result"></div>
    </section>
  </main>
  <footer>
    <a href="index.html">Back to User Site</a> &nbsp;|&nbsp; &copy; 2024 MAZOL-Pro
  </footer>
  <script>
    // Admin login
    document.getElementById('admin-login-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const username = document.getElementById('admin-username').value;
      const password = document.getElementById('admin-password').value;
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'login', username, password })
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('admin-login-section').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
      }
      document.getElementById('admin-login-result').innerText = data.message || data.error || '';
    });

    // User search and settings
    document.getElementById('user-search-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const user = document.getElementById('user-search').value;
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'getUser', user })
      });
      const data = await res.json();
      if (data.user) {
        document.getElementById('user-settings').innerHTML = `
          <b>User:</b> ${data.user.wallet || data.user.email}<br>
          <b>Status:</b> ${data.user.isGold ? "Gold" : "Silver"}<br>
          <b>Total Purchased:</b> ${data.user.totalPurchased || 0}<br>
          <button onclick="setGold('${data.user.wallet}')">Set Gold</button>
          <button onclick="setSilver('${data.user.wallet}')">Set Silver</button>
        `;
      } else {
        document.getElementById('user-settings').innerText = data.message || data.error || '';
      }
    });

    async function setGold(wallet) {
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'setGold', wallet })
      });
      const data = await res.json();
      alert(data.message || data.error || '');
    }
    async function setSilver(wallet) {
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'setSilver', wallet })
      });
      const data = await res.json();
      alert(data.message || data.error || '');
    }

    // Manual deposit approvals
    async function fetchDeposits() {
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'getPendingDeposits' })
      });
      const data = await res.json();
      if (data.deposits && data.deposits.length) {
        document.getElementById('pending-deposits').innerHTML = data.deposits.map(d =>
          `<div>
            <b>User:</b> ${d.wallet}<br>
            <b>Amount:</b> ${d.amount}<br>
            <button onclick="approveDeposit('${d._id}')">Approve</button>
          </div><hr>`
        ).join('');
      } else {
        document.getElementById('pending-deposits').innerText = "No pending deposits.";
      }
    }
    async function approveDeposit(id) {
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'approveDeposit', id })
      });
      const data = await res.json();
      alert(data.message || data.error || '');
      fetchDeposits();
    }

    // Withdrawal management
    async function fetchWithdrawals() {
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'getPendingWithdrawals' })
      });
      const data = await res.json();
      if (data.withdrawals && data.withdrawals.length) {
        document.getElementById('pending-withdrawals').innerHTML = data.withdrawals.map(w =>
          `<div>
            <b>User:</b> ${w.wallet}<br>
            <b>Amount:</b> ${w.amount}<br>
            <button onclick="approveWithdrawal('${w._id}')">Approve</button>
          </div><hr>`
        ).join('');
      } else {
        document.getElementById('pending-withdrawals').innerText = "No pending withdrawals.";
      }
    }
    async function approveWithdrawal(id) {
      const res = await fetch('/api/admin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'approveWithdrawal', id })
      });
      const data = await res.json();
      alert(data.message || data.error || '');
      fetchWithdrawals();
    }
  </script>
</body>
</html>
